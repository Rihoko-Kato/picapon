<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>picapon | ぴかぽん公式サイト</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>

    <header>
        <a href="#" class="logo">picapon</a>
        <div class="hamburger-menu">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <nav>
            <ul>
                <li><a href="#concept">Concept</a></li>
                <li><a href="#features">Features</a></li>
                <li><a href="#research">Research</a></li>
                <li><a href="#howtouse">How to use</a></li>
                <li><a href="#faq">Q&A</a></li>
                <li><a href="#contact">Contact</a></li>
            </ul>
        </nav>
    </header>

    <section class="hero">
        <div class="hero-content">
            <h1 class="fade-in">一人暮らしでも、<br>「行ってきます」「ただいま」を<br>言う暮らしを。</h1>
            <p class="fade-in-delay sub-text">お見送りとお出迎えをしてくれるロボット</p>
            <div class="fade-in-delay">
                <img src="images/logo.png" alt="picapon" class="hero-logo">
            </div>
        </div>
        <div class="hero-image-placeholder">
            <img src="images/mainimage.png" alt="ぴかぽんメイン画像" class="hero-img">
        </div>
    </section>

    <section id="concept" class="section-concept">
        <div class="container">
            <h2>ぴかぽんって？</h2>
            <div class="concept-layout">
                <div class="concept-text">
                    <p class="lead-text">
                        ぴかぽんは、別の星からやってきた！<br>
                        人間の「さみしさ」が生まれる場所に現れます。<br>
                        地球では、玄関がその場所でした。
                    </p>
                    <p>
                        ぴかぽんは、自ら話しかけはしません。<br>
                        ただ、玄関であなたの生活を見守ります。
                    </p>
                </div>
                <div class="concept-image">
                    <img src="images/insekipon.png" alt="隕石" class="img-origin">
                    <img src="images/insekipon1.png" alt="ぴかぽん" class="img-flying">
                    
                    <!-- ミニゲーム用UI -->
                    <div id="game-score" class="game-score">0 / 10</div>
                    <div id="game-win-overlay" class="game-win-overlay">
                        <div class="win-title">🎉 CLEAR! 🎉</div>
                        <button id="restart-game-btn" class="game-start-btn">もう一回！</button>
                        <button id="stop-game-btn" class="game-start-btn" style="margin-top: 10px; font-size: 0.9rem; background: #999; border-color: #eee; box-shadow: none;">もうかわいそうだからやめる</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="features" class="section-features">
        <div class="container">
            <h2>提供する価値</h2>
            <div class="feature-grid">
                <div class="feature-item">
                    <div class="circle">
                        <span class="circle-title">寂しさの<br>軽減</span>
                        <p class="detail-text">
                            誰もいない家に帰る虚しさがなくなります。<br>
                            「おかえり」の温かさを。
                        </p>
                    </div>
                </div>
                <div class="feature-item">
                    <div class="circle">
                        <span class="circle-title">生活の<br>区切りをつける</span>
                        <p class="detail-text">
                            「行ってきます」で気持ちを切り替え、<br>
                            「ただいま」でホッと一息つく。
                        </p>
                    </div>
                </div>
                <div class="feature-item">
                    <div class="circle">
                        <span class="circle-title">防犯に<br>つながる習慣</span>
                        <p class="detail-text">
                            声に出すことで、在宅をアピール。<br>
                            日々の防犯意識も高まります。
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="research" class="section-research">
        <div class="container">
            <span class="label-english">Research</span>
            <h2>ロボットが自分の声に反応して<br>挨拶してくれることは嬉しいですか？</h2>
            
            <div class="research-content">
                <div class="graph-placeholder">
                    <div class="pie-chart">
                        <span class="percentage">81%</span>
                    </div>
                    <p class="caption">「とても嬉しい」「まあまあ嬉しい」</p>
                </div>
                <div class="research-text">
                    <h3>一人暮らしの女性の多くが<br>肯定的に捉えています。</h3>
                    <p>（Group18調べ）</p>
                </div>
            </div>
        </div>
    </section>

    <section id="howtouse" class="section-howtouse">
        <div class="container">
            <h2>つかいかた</h2>
            <div class="howtouse-content">
                <div class="steps">
                    <div class="step">
                        <h3>01. 設置</h3>
                        <p>玄関の平らな場所に設置してください。<br>コハク色の光があなたを待っています。</p>
                    </div>
                    <div class="step">
                        <h3>02. 声かけ</h3>
                        <div class="interaction-demo">
                            <div class="demo-box">
                                <span class="user-voice">「行ってきます」</span>
                                <span class="robot-response">短い鳴き声<br>＋<br>うつむく</span>
                                <p class="note">朝は忙しいため、<br>寂しそうに見送ります。</p>
                            </div>
                            <div class="demo-box">
                                <span class="user-voice">「ただいま」</span>
                                <span class="robot-response">長めの鳴き声<br>＋<br>全身で喜び</span>
                                <p class="note">あなたの帰宅を<br>光とうなずきで喜びます。</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="usage-image-container">
                    <img src="images/siyouimage.png" alt="使用イメージ" class="usage-img">
                </div>
            </div>
        </div>
    </section>

    <section id="movie" class="section-movie">
        <div class="container">
            <h2>ぴかぽんの様子</h2>
            <p class="movie-instruction">動画撮影ボタンを押そう！</p>
            <div class="smartphone-frame-wrapper">
                <div class="phone-and-hand-container">
                    <div class="smartphone-frame-landscape">
                        <div class="screen camera-interface">
                            <!-- ビューファインダーとしての動画 -->
                            <video autoplay muted loop playsinline class="viewfinder">
                                <source src="movie/picaponmovie.mp4" type="video/mp4">
                            </video>
                            
                            <!-- カメラアプリのUI -->
                            <div class="camera-overlay">
                                <div class="camera-controls-left">
                                    <span class="cam-icon flash-icon">⚡</span>
                                    <span class="cam-icon live-icon">◎</span>
                                </div>
                                
                                <div class="camera-grid-lines">
                                    <div class="grid-line-h"></div>
                                    <div class="grid-line-h"></div>
                                    <div class="grid-line-v"></div>
                                    <div class="grid-line-v"></div>
                                    <div class="focus-area">+</div>
                                </div>

                                <div class="camera-controls-right">
                                    <!-- シンプルに録画ボタンのみ配置 -->
                                    <button class="record-btn"></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 左手親指（フレームの外に出しました） -->
                    <div class="hand-thumb-simple"></div>
                </div>
            </div>
        </div>
    </section>

    <section id="faq" class="section-faq">
        <div class="container">
            <h2>よくある質問</h2>
            <div class="faq-list">
                <!-- Q1 -->
                <div class="faq-item">
                    <div class="faq-question">
                        <p>「ぴかぽんがぐっすり<br>眠ったまま起きない...」</p>
                        <p>「耳が遠いみたい...」</p>
                        <p class="sub-q">（声に反応しない）</p>
                    </div>
                    <div class="faq-answer">
                        <ul>
                            <li>
                                <span class="bullet-title">ぴかぽんがお腹を空かせていませんか？</span>
                                <p class="bullet-desc">１週間に１回程度充電ケーブルを繋いでエネルギーを補給してください。</p>
                            </li>
                            <li>
                                <span class="bullet-title">内部のケーブルが外れていませんか？</span>
                                <p class="bullet-desc">ちゃんと繋がっているか確認してあげてください。</p>
                            </li>
                            <li>
                                <span class="bullet-title">周りがうるさくありませんか？</span>
                                <p class="bullet-desc">騒がしいとあなたの声を聞き取れない事があります。近づいて、はっきりと声をかけてみてください。</p>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Q2 -->
                <div class="faq-item">
                    <div class="faq-question">
                        <p>「呼びかけていないのに<br>反応した...」</p>
                    </div>
                    <div class="faq-answer">
                        <ul>
                            <li>
                                <span class="bullet-title">テレビや電話で話し声がしていませんか？</span>
                                <p class="bullet-desc">人の声に反応して空耳をしてしまったのかもしれません。「張り切っているな」と見守ってあげてください。</p>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Q3 -->
                <div class="faq-item">
                    <div class="faq-question">
                        <p>「ジー、ウィーン、という<br>音がしている」</p>
                    </div>
                    <div class="faq-answer">
                        <ul>
                            <li>
                                <span class="bullet-title">ぴかぽんが動く時に鳴っていませんか？</span>
                                <p class="bullet-desc">ぴかぽんが一生懸命動いている時の音です。故障ではありませんのでご安心ください。</p>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Q4 -->
                <div class="faq-item">
                    <div class="faq-question">
                        <p>「なんだかぴかぽんが<br>暖かい気がする」</p>
                    </div>
                    <div class="faq-answer">
                        <ul>
                            <li>
                                <span class="bullet-title">充電中または長時間のおしゃべり中ですか？</span>
                                <p class="bullet-desc">長時間おしゃべりしたり、ご飯を食べている時は少し体温が上がります。触れないほどの熱さの場合は一度休ませてあげてください。充電中の場合はケーブルを抜いてください。</p>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="theme-song" class="section-theme-song">
        <div class="container">
            <h2>ぴかぽん公式ソング</h2>
            <div class="song-container">
                <p class="song-description">ぴかぽんとの暮らしをイメージした、<br>心温まる公式テーマソングです。<br>ぜひ聴いてみてください。</p>
                
                <!-- レコードプレーヤー -->
                <div class="record-player-wrapper">
                    <div class="record-player" id="record-player">
                        <!-- レコード盤 -->
                        <div class="vinyl-record" id="vinyl-record">
                            <div class="vinyl-grooves"></div>
                            <div class="vinyl-label">
                                <span class="label-text">Picapon<br>Song</span>
                            </div>
                        </div>
                        <!-- トーンアーム（針） -->
                        <div class="tone-arm" id="tone-arm">
                            <div class="tone-arm-axis"></div>
                            <div class="tone-arm-rod"></div>
                            <div class="tone-arm-head"></div>
                        </div>
                        <div class="click-hint">Click to Play</div>
                    </div>
                </div>

                <!-- 音源（非表示で制御） -->
                <audio id="picapon-audio">
                    <source src="music/picapon_song.mp3" type="audio/mpeg">
                </audio>

                <button id="toggle-lyrics-btn" class="toggle-lyrics-btn">歌詞を表示 ▼</button>
                <div id="lyrics-container" class="lyrics-container">
                    <div class="lyrics-text">
                        <p>
                            ねえ　おきて<br>
                            そっと　ゆびさきで　トントン<br>
                            ピカ…オン？<br>
                            きょうも　まもるよ　ドアのまえ
                        </p>
                        <p>
                            ちいさな　まるい　からだで<br>
                            きょうの　きぶん　つたえたい<br>
                            くつばこ　かどで　まってる<br>
                            「まだかな？」って　こころ　そわそわ
                        </p>
                        <p>
                            ぴかぽん　ぴかぽん　ただいまソング<br>
                            しっぽみたいに　からだが　ぴょん<br>
                            「いってきます」に　ぴって　おへんじ<br>
                            ドアがあくたび　きみとスタート<br>
                            ぴかぽん　ぴかぽん　おかえりダンス<br>
                            ちいさなこえで　おつかれさま<br>
                            あいさつひとつで　あたたかくなる<br>
                            げんかんが　きみの　まほうのばしょ
                        </p>
                        <p>
                            あさのひかりを　あびながら<br>
                            ねぼけまなこを　みまもってる<br>
                            イッテラッシャイ<br>
                            ちいさくはねて　みおくるよ
                        </p>
                        <p>
                            よるのにおいを　つれてきて<br>
                            かぎのひびきが　きこえたら<br>
                            オカエリナサイ<br>
                            うれしくなって　またはねる
                        </p>
                        <p>
                            ぴかぽん　ぴかぽん　ただいまソング<br>
                            しっぽみたいに　からだが　ぴょん<br>
                            「いってきます」に　ぴって　おへんじ<br>
                            ドアがあくたび　きみとスタート<br>
                            ぴかぽん　ぴかぽん　おかえりダンス<br>
                            ちいさなこえで　おつかれさま<br>
                            あいさつひとつで　あたたかくなる<br>
                            げんかんが　きみの　まほうのばしょ
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="contact" class="section-contact">
        <div class="container">
            <h2>お問い合わせ</h2>
            <form class="contact-form">
                <div class="form-group">
                    <label for="name">お名前</label>
                    <input type="text" id="name" name="name" placeholder="山田 太郎" required>
                </div>
                <div class="form-group">
                    <label for="email">メールアドレス</label>
                    <input type="email" id="email" name="email" placeholder="example@picapon.com" required>
                </div>
                <div class="form-group">
                    <label for="category">件名</label>
                    <select id="category" name="category">
                        <option value="product">製品について</option>
                        <option value="support">サポート・修理について</option>
                        <option value="other">その他</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="message">内容</label>
                    <textarea id="message" name="message" rows="5" placeholder="お問い合わせ内容をご記入ください" required></textarea>
                </div>
                <div class="form-footer">
                    <p class="contact-note">※通常、1〜2営業日以内に担当者よりご連絡いたします。</p>
                    <button type="submit" class="btn-submit">送信する</button>
                </div>
            </form>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-logo">picapon</div>
            <p>&copy; 2026 18班 (Group 18) All Rights Reserved.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate');
                    }
                });
            });

            const pieChart = document.querySelector('.pie-chart');
            if (pieChart) {
                observer.observe(pieChart);
            }

            // ハンバーガーメニューの開閉処理
            const hamburger = document.querySelector('.hamburger-menu');
            const nav = document.querySelector('nav');
            const navLinks = document.querySelectorAll('nav a');

            if (hamburger && nav) {
                hamburger.addEventListener('click', () => {
                    hamburger.classList.toggle('active');
                    nav.classList.toggle('active');
                });

                // メニューリンクをクリックしたら閉じる
                navLinks.forEach(link => {
                    link.addEventListener('click', () => {
                        hamburger.classList.remove('active');
                        nav.classList.remove('active');
                    });
                });
            }

            // Featuresの丸をスマホでタップしたときの挙動
            const circles = document.querySelectorAll('.circle');
            circles.forEach(circle => {
                circle.addEventListener('click', function(e) {
                    // 他の円のactiveクラスを外す（ひとつだけ開くようにする）
                    circles.forEach(c => {
                        if (c !== this) {
                            c.classList.remove('active');
                        }
                    });
                    
                    // 自分自身にactiveクラスをトグル
                    this.classList.toggle('active');
                });
            });

            // 歌詞の開閉
            const lyricsBtn = document.getElementById('toggle-lyrics-btn');
            const lyricsContainer = document.getElementById('lyrics-container');

            if (lyricsBtn && lyricsContainer) {
                lyricsBtn.addEventListener('click', () => {
                    const isOpen = lyricsContainer.classList.contains('active');
                    if (isOpen) {
                        lyricsContainer.classList.remove('active');
                        // スタイルでdisplay:noneにしているのでクラス操作だけで消えるはずだが、
                        // もしCSSの詳細度などで消えない場合は手動設定が必要
                        // ここではCSSの .lyrics-container { display: none; } と .active { display: block; } に依存
                        lyricsBtn.textContent = '歌詞を表示 ▼';
                    } else {
                        lyricsContainer.classList.add('active');
                        lyricsBtn.textContent = '歌詞を閉じる ▲';
                    }
                });
            }

            // レコードプレーヤー制御
            const recordPlayer = document.getElementById('record-player');
            const vinylRecord = document.getElementById('vinyl-record');
            const toneArm = document.getElementById('tone-arm');
            const audio = document.getElementById('picapon-audio');
            const clickHint = document.querySelector('.click-hint');

            if (recordPlayer && audio) {
                recordPlayer.addEventListener('click', () => {
                    if (audio.paused) {
                        // 再生開始フロー
                        
                        // 1. 針を動かす
                        toneArm.classList.add('playing');
                        
                        // 2. 少し遅れてレコードを回し、音を出す（針が落ちるタイミング）
                        setTimeout(() => {
                            vinylRecord.classList.add('playing');
                            audio.play().catch(e => console.log('再生エラー:', e));
                            clickHint.textContent = 'Playing...';
                        }, 500); // 0.5秒待つ

                    } else {
                        // 停止フロー
                        audio.pause();
                        vinylRecord.classList.remove('playing');
                        toneArm.classList.remove('playing');
                        clickHint.textContent = 'Click to Play';
                    }
                });

                // 曲が終わったら自動的に針を戻す
                audio.addEventListener('ended', () => {
                    vinylRecord.classList.remove('playing');
                    toneArm.classList.remove('playing');
                    clickHint.textContent = 'Click to Play';
                });
            }

            // カメラ動画制御
            const video = document.querySelector('.viewfinder');
            const recordBtn = document.querySelector('.record-btn');

            if (video && recordBtn) {
                // ボタンの状態を更新する関数
                const updateButtonState = () => {
                    if (!video.paused) {
                        recordBtn.classList.add('recording');
                    } else {
                        recordBtn.classList.remove('recording');
                    }
                };

                // 初期状態を確認
                updateButtonState();

                // ボタンクリックで再生/停止
                recordBtn.addEventListener('click', () => {
                    // ユーザー操作時にミュートを解除して音を出す
                    video.muted = false;
                    
                    if (video.paused) {
                        video.play();
                    } else {
                        video.pause();
                    }
                });

                // 動画自体のイベントも監視（ループなどで止まった場合など）
                video.addEventListener('play', updateButtonState);
                video.addEventListener('pause', updateButtonState);
            }

            // --- パーティクル生成関数 ---
            function createBurstParticles(container, centerX, centerY) {
                const particleCount = 20; 
                const colors = ['#f9d423', '#ff4e50', '#ffffff', '#F8E6C8']; 

                for (let i = 0; i < particleCount; i++) {
                    const p = document.createElement('div');
                    p.classList.add('pika-particle');
                    p.style.left = `${centerX}px`;
                    p.style.top = `${centerY}px`;
                    p.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    
                    const angle = Math.random() * 360 * (Math.PI / 180);
                    const velocity = 50 + Math.random() * 150;
                    const tx = Math.cos(angle) * velocity;
                    const ty = Math.sin(angle) * velocity;
                    p.style.setProperty('--tx', `${tx}px`);
                    p.style.setProperty('--ty', `${ty}px`);
                    
                    const duration = 0.5 + Math.random() * 0.5;
                    p.style.animation = `particleMove ${duration}s ease-out forwards`;
                    
                    container.appendChild(p);
                    setTimeout(() => p.remove(), duration * 1000);
                }
            }

            // --- ミニゲームロジック ---
            const restartBtn = document.getElementById('restart-game-btn');
            const stopGameBtn = document.getElementById('stop-game-btn');
            const scoreDisplay = document.getElementById('game-score');
            const winOverlay = document.getElementById('game-win-overlay');
            const conceptContainer = document.querySelector('.concept-image');
            const imgFlying = document.querySelector('.img-flying');
            
            let gameScore = 0;
            let gameInterval = null;
            let isGameRunning = false;
            const winAudio = document.getElementById('picapon-audio'); 

            if (conceptContainer && imgFlying) {
                // 初期設定：画像をクリック可能に
                imgFlying.style.cursor = 'pointer';

                // ゲームリセット（停止）関数
                const stopGame = () => {
                    isGameRunning = false;
                    clearInterval(gameInterval);
                    scoreDisplay.style.display = 'none';
                    winOverlay.classList.remove('active');

                    // 音楽とレコード停止
                    if (winAudio) {
                        winAudio.pause();
                        winAudio.currentTime = 0;
                        const vinylRecord = document.getElementById('vinyl-record');
                        const toneArm = document.getElementById('tone-arm');
                        const clickHint = document.querySelector('.click-hint');
                        
                        if (vinylRecord) vinylRecord.classList.remove('playing');
                        if (toneArm) toneArm.classList.remove('playing');
                        if (clickHint) clickHint.textContent = 'Click to Play';
                    }

                    // ぴかぽんがもし消えてたら復活（通常はCLEAR直後に復活しているが念のため）
                    imgFlying.classList.remove('bursting');
                    imgFlying.classList.add('respawn');
                };

                // ゲーム開始処理
                const startGame = () => {
                    if (isGameRunning) return;
                    isGameRunning = true;
                    gameScore = 0;
                    scoreDisplay.textContent = `${gameScore} / 10`;
                    scoreDisplay.style.display = 'block';
                    winOverlay.classList.remove('active');

                    // 音楽とレコードのアニメーションを停止
                    if (winAudio) {
                        winAudio.pause();
                        winAudio.currentTime = 0;
                        const vinylRecord = document.getElementById('vinyl-record');
                        const toneArm = document.getElementById('tone-arm');
                        const clickHint = document.querySelector('.click-hint');
                        
                        if (vinylRecord) vinylRecord.classList.remove('playing');
                        if (toneArm) toneArm.classList.remove('playing');
                        if (clickHint) clickHint.textContent = 'Click to Play';
                    }

                    // 1秒ごとにターゲット生成
                    gameInterval = setInterval(spawnTarget, 800);
                };

                // Big Pika Click Event (Start Game)
                imgFlying.addEventListener('click', (e) => {
                    if (isGameRunning || imgFlying.classList.contains('bursting')) return;

                    // エフェクト演出
                    imgFlying.classList.add('bursting');
                    imgFlying.classList.remove('respawn'); // 復活アニメーションを消す
                    
                    const rect = imgFlying.getBoundingClientRect();
                    const containerRect = conceptContainer.getBoundingClientRect();
                    const centerX = rect.left + rect.width / 2 - containerRect.left;
                    const centerY = rect.top + rect.height / 2 - containerRect.top;
                    createBurstParticles(conceptContainer, centerX, centerY);

                    // ここでは復活タイマーをセットせず、ゲームを開始する
                    // ゲーム中は非表示のまま (CSSの bursting 状態で scale(0) opacity:0 になって消える)
                    
                    // 少し遅れてゲーム開始（エフェクトが見えてから）
                    setTimeout(startGame, 300);
                });

                if (restartBtn) {
                    restartBtn.addEventListener('click', startGame);
                }
                
                if (stopGameBtn) {
                    stopGameBtn.addEventListener('click', stopGame);
                }

                // ターゲット生成
                function spawnTarget() {
                    if (gameScore >= 10) return; 

                    const target = document.createElement('img');
                    target.src = 'images/insekipon1.png';
                    target.classList.add('falling-target');
                    
                    const containerWidth = conceptContainer.clientWidth;
                    const randomX = Math.random() * (containerWidth - 60); 
                    target.style.left = `${randomX}px`;
                    target.style.top = '-80px'; 

                    const duration = 2 + Math.random() * 2;
                    target.style.animation = `targetFallGame ${duration}s linear forwards`;

                    target.addEventListener('mousedown', (e) => { 
                        e.stopPropagation();
                        hitTarget(target);
                    });
                    
                    target.addEventListener('animationend', () => {
                        target.remove();
                    });

                    conceptContainer.appendChild(target);
                }

                // ターゲット命中
                function hitTarget(target) {
                    if (!isGameRunning) return;
                    
                    const rect = target.getBoundingClientRect();
                    const containerRect = conceptContainer.getBoundingClientRect();
                    const centerX = rect.left + rect.width/2 - containerRect.left;
                    const centerY = rect.top + rect.height/2 - containerRect.top;

                    createBurstParticles(conceptContainer, centerX, centerY);
                    target.remove();
                    
                    gameScore++;
                    scoreDisplay.textContent = `${gameScore} / 10`;

                    if (gameScore >= 10) {
                        gameWin();
                    }
                }

                // 勝利処理
                function gameWin() {
                    isGameRunning = false;
                    clearInterval(gameInterval);
                    
                    const targets = document.querySelectorAll('.falling-target');
                    targets.forEach(t => {
                        const rect = t.getBoundingClientRect();
                        const containerRect = conceptContainer.getBoundingClientRect();
                        createBurstParticles(conceptContainer, 
                            rect.left + rect.width/2 - containerRect.left, 
                            rect.top + rect.height/2 - containerRect.top
                        );
                        t.remove();
                    });

                    winOverlay.classList.add('active');
                    
                    // ゲーム終了後に元の巨大ぴかぽんを復活させる
                    setTimeout(() => {
                        imgFlying.classList.remove('bursting');
                        imgFlying.classList.add('respawn');
                    }, 500);

                    // 音楽再生
                    if (winAudio) {
                        winAudio.currentTime = 0;
                        winAudio.play().catch(e => console.log(e));
                        const vinylRecord = document.getElementById('vinyl-record');
                        const toneArm = document.getElementById('tone-arm');
                        if (vinylRecord) vinylRecord.classList.add('playing');
                        if (toneArm) toneArm.classList.add('playing');
                    }
                }
            }
        });
    </script>

</body>
</html>